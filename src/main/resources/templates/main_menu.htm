<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PelisApp - Main Menu</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <style>
        .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:1rem; margin-top:1rem; }
        .card { background:#fff; border-radius:6px; box-shadow:0 4px 10px rgba(0,0,0,0.06); overflow:hidden; text-align:center; }
        .poster { width:100%; height:210px; object-fit:cover; display:block; }
        .card-title { padding:0.5rem; font-size:0.95rem; }
    </style>
</head>
<body>
<header>
    <h1>PelisApp</h1>
    <nav>
        <a th:href="@{/}">Inicio</a> |
        <a th:href="@{/peliculas}">Películas</a> |
        <a th:href="@{/perfil}">Mi perfil</a> |
        <a th:href="@{/login}">Iniciar sesión</a>
    </nav>
</header>
<main>
    <section>
        <h2>Últimas películas</h2>
        <p>Accede a las últimas reseñas, críticas y perfiles de críticos.</p>

        <form method="get" th:action="@{/}">
            <label for="genre">Género:</label>
            <select id="genre" name="genre">
                <option th:value="" th:text="'Todos'" th:selected="${selectedGenre == null}">Todos</option>
                <option th:each="c : ${categories}" th:value="${c.name}" th:text="${c.name}" th:selected="${c.name == selectedGenre}"></option>
            </select>
            <label for="size">Por página:</label>
            <select id="size" name="size">
                <option th:value="12" th:selected="${moviesPage.size == 12}">12</option>
                <option th:value="24" th:selected="${moviesPage.size == 24}">24</option>
                <option th:value="48" th:selected="${moviesPage.size == 48}">48</option>
            </select>
            <button type="submit">Filtrar</button>
        </form>

        <div class="grid">
            <div th:each="m : ${movies}" class="card">
                <a th:href="@{/pelicula/{id}(id=${m.id})}">
                    <div th:with="poster=${m.posterLocalPath != null && !#strings.isEmpty(m.posterLocalPath) ? m.posterLocalPath : (m.posterPath != null and m.posterPath.startsWith('http') ? m.posterPath : (m.posterPath != null ? tmdbBaseUrl + '/w500' + (m.posterPath.startsWith('/') ? m.posterPath : '/' + m.posterPath) : null))}">
                        <img th:src="${poster}"
                             th:alt="${m.title}" class="poster"
                             th:attr="title=${poster}"
                             onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22450%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23ddd%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23666%22 font-size=%2220%22>No image</text></svg>'" />
                    </div>
                </a>
                <div th:if="${param.debug != null}" style="font-size:0.7rem;color:#666;padding:0.3rem;word-break:break-all;">URL: <span th:text="${poster}">-</span></div>
                <div class="card-title" th:text="${m.title}">Título</div>
            </div>
        </div>

        <div style="margin-top:1rem; display:flex; align-items:center; gap:1rem;">
            <div>
                <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span>
            </div>
            <div>
                <a th:if="${currentPage > 0}" th:href="@{/(page=${currentPage - 1}, size=${pageSize}, genre=${selectedGenre})}">Anterior</a>
                <span th:each="p : ${pageNumbers}">
                    <a th:href="@{/(page=${p}, size=${pageSize}, genre=${selectedGenre})}"
                       th:text="${p + 1}"
                       th:classappend="${p == currentPage} ? ' current' : ''"></a>
                </span>
                <a th:if="${currentPage + 1 < totalPages}" th:href="@{/(page=${currentPage + 1}, size=${pageSize}, genre=${selectedGenre})}">Siguiente</a>
            </div>
        </div>
    </section>
</main>
<footer>
    <small>&copy; PelisApp</small>
</footer>
</body>
</html>
